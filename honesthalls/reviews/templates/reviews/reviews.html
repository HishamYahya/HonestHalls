{% load divide_filter %}
{% load int_filter %}
{% load rating_filter %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap 4 Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <script src="{% static 'reviews/js/main.js' %}"></script>
</head>
<body onload="on_body_load('{{review_ids}}')">
	{% for review in reviews %}
		{% with noise=review.noise|convert_to_int %}
		{% with social=review.social_life|convert_to_int %}
		{% with facilities=review.facilities|convert_to_int %}
		{% with cleanliness=review.cleanliness|convert_to_int %}
		{% with rating=reviewratings|rating_filter:review.id %}
		{% with user_rating=userratings|user_rating_filter:review.id %}
		{% with total=noise|add:facilities|add:social|add:cleanliness %}
		{% with average=total|divide_filter %}

		<div class="container-fluid pt-3 my-3 border border-info bg-white text-dark shadow-sm">

			<div class = "row">

				<div class = "col-auto align-self-center mb-4">
						<div class = "row mb-2 ml-1" onmouseenter="up_button_enter('{{review.id}}')" onmouseleave="up_button_leave('{{review.id}}', '{{user_rating}}')">
							{% if review.user == currentuser %}
								<button class="btn btn-xs btn-secondary disabled" id="upButton{{review.id}}"disabled>
									<i class="material-icons">thumb_up</i>
								</button>
							{% elif user_rating == True %}
								<button class="btn btn-xs btn-primary" id="upButton{{review.id}}">
									<i class="material-icons">thumb_up</i>
								</button>
							{% else %}
								<button class="btn btn-xs btn-secondary" id="upButton{{review.id}}">
									<i class="material-icons">thumb_up</i>
								</button>
							{% endif %}
						</div>
						<div class = "row-xs mt-2 mb-2">
							<center><h5 class = "ml-3" id="rating{{review.id}}">{{rating}}</h5></center>
						</div>
						<div class = "row mt-2 ml-1" onmouseenter="down_button_enter('{{review.id}}')" onmouseleave="down_button_leave('{{review.id}}', '{{user_rating}}')">
							{% if review.user == currentuser %}
								<button class="btn btn-xs btn-secondary disabled" id="downButton{{review.id}}" action="#" disabled>
										<i class="material-icons">thumb_down</i>
								</button>
							{% elif user_rating == False %}
								<button class="btn btn-xs btn-danger" id="downButton{{review.id}}" action="#">
										<i class="material-icons">thumb_down</i>
								</button>
							{% else %}
								<button class="btn btn-xs btn-secondary" id="downButton{{review.id}}" href="#">
										<i class="material-icons">thumb_down</i>
								</button>
							{% endif %}
						</div>
				</div>

				<div class = "col-4">
					<table class="table table-borderless" style="max-width:350px;">
						<tbody>
							<tr>
								<td><h5>Noise:</h5></td>
								<td ><input class="hh-rating-input" value="{{review.noise}}" readonly></td>
							</tr>
							<tr>
								<td><h5>Social:</h5></td>
								<td><input class="hh-rating-input" value="{{review.social_life}}" readonly></td>
							</tr>
							<tr>
								<td><h5>Cleanliness:</h5></td>
								<td><input class="hh-rating-input" value="{{review.cleanliness}}" readonly></td>
							</tr>
							<tr>
								<td><h5>Facilities:</h5></td>
								<td><input class="hh-rating-input" value="{{review.facilities}}" readonly></td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="col-7">
					<div class="row">
						<div class="col-5">
							<center>
								{% if review.anonymous == True %}
									<h5 class="mt-3">Anonymous
									<i class="material-icons ml-3", style="vertical-align:text-bottom;">verified_user</i></h5>
								{% else %}
									<h5 class="mt-3">{{review.user.first_name}} {{review.user.last_name}}
									<i class="material-icons ml-3", style="vertical-align:text-bottom;">verified_user</i></h5>
								{% endif %}
								<p style="font-size: 12px">Date Created: {{review.date_created.date}}</p>
							</center>
						</div>
						<div class="col ml-3">	
							<h5 class="mt-2"><h5 class="ml-2">Average Rating</h5>
							<input class="hh-rating-input" value="{{average}}" readonly></h5>
						</div>
						<div class="col-sm-3 ml-1">
							{% if review.user == currentuser %}
								<a class="btn btn-xs btn-primary mt-3" href="{% url 'review-edit' review.id %}">
									<i class="material-icons">edit</i>
								</a>
								<form class="d-inline" id = "delete-form" action="{% url 'review-delete' review.id %}" method="POST">
									{% csrf_token %}
									<button class="btn btn-xs btn-danger ml-3 mt-3" type = "button" onclick="delete_review()">
										<i class="material-icons">delete</i>
									</button>
								</form>
							{% else %}
								<a class="btn btn-xs btn-danger float-right mr-4 mt-1" href="#">
									REPORT
									<i class="material-icons ml-2">new_releases</i>
								</a>
							{% endif %}

						</div>
					</div>
					<p class="mt-3 ml-3 mr-3 mb-3"><i>
						"{{review.text}}"</i>
					</p>
				</div>
			</div>

			{% if reviewphotos %}
				<div class="row mb-4 border">
					<!-- SHOW PHOTOS FOR REVIEW- POP UP OPTION?? -->
					{% for photo in reviewphotos %}
						{% if photo.review.id == review.id %}
							<div class="col mt-3 mb-3" style="max-width: 400px;">
								<center>
									<img class="hh-image-supports-preview" style="max-height:180px; max-width: 320px;" src="{{ photo.photo_path.url }}" alt="{{ photo.photo_desc }}" />
								</center>
							</div>
						{% endif %}
					{% endfor %}
				</div>
			{% endif %}

		</div>
		{% endwith %}
		{% endwith %}
		{% endwith %}
		{% endwith %}
		{% endwith %}
		{% endwith %}
		{% endwith %}
		{% endwith %}

	{% empty %}
		<h5 class="text-muted ml-3 mt-2">No Reviews Found</h5>
	{% endfor %}
	</body>
</html>